!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},n.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=20)}([function(t,e){t.exports=ex},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(0),o=n(17),i="/hackathon-2018.1-team30";class s{static values(){return Object.values(s)}}s.Audi=new r.Texture(i+"/assets/sprites/audi.png"),s.Chickens=new r.Texture(i+"/assets/sprites/chickens.png"),s.DudeNude=new r.Texture(i+"/assets/sprites/dude_nude.png"),s.Level1=new o.default(i+"/assets/levels/1.json"),s.Aim=new r.Texture(i+"/assets/sprites/aim.png"),e.Resources=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=new(n(15).HubConnection)("http://10.33.94.6:4844/game");let o=null;r.onclose(()=>{console.log("Пичаль")});class i{static addFowl(t){this.fowls[t.user.id]=t}static start(){r.start()}static saveUser(t){o=t}static saveOtherPlayer(t){this.otherPlayers[t.user.id]=t}static get currentUser(){return o}static getActor(t){if(o&&o.user.id===t)return o.actor;const e=this.otherPlayers[t];if(e)return e.actor;const n=this.fowls[t];return n?n.actor:null}static userInGame(t){return!(!i.otherPlayers||null==i.otherPlayers[t])||!(!i.currentUser||i.currentUser.user.id!==t)}static get otherPlayers(){return i.otherUsers}static join(){r.invoke("join").catch(t=>console.log("catch: ",t))}static get connection(){return r}static fire(t){r.invoke("attackPlayer",t)}static move(t,e){r.invoke("movePlayer",t,e)}static kickUser(t){this.otherPlayers&&t&&delete this.otherPlayers[t.id]}static killFowl(t){this.fowls&&t&&delete this.fowls[t.id]}static spawnFowl(t){r.invoke("spawnFowl")}}i.otherUsers={},i.fowls={},e.GameService=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(0);class o extends r.Actor{constructor(){super(...arguments),this.direction=r.Vector.Zero.clone(),this.drawDirection="down",this.drawState="idle",this.updateDrawState=(()=>{this.setDrawing(`${this.drawState}_${this.drawDirection}`)})}update(t,e){super.update(t,e),this.updateDirection()}registerDrawing(t){for(const e in t){const n=t[e];for(const t in n){const r=n[t];this.addDrawing(`${e}_${t}`,r)}}}updateDirection(){this.direction.equals(r.Vector.Zero)?this.drawState="idle":(this.drawState="walk",this.drawDirection=o.getDrawDirection(this.direction)),this.updateDrawState()}static getDrawDirection(t){return t.y<0?0===t.x?"up":t.x>0?"up_right":"up_left":t.y>0?0===t.x?"down":t.x>0?"down_right":"down_left":0===t.x?"down":t.x>0?"right":"left"}}e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(0),o=200;e.GunFire=class extends r.Actor{constructor(t=!1){super(0,0,200,10,r.Color.Rose),this.isInterection=t,this.isEnabled=!1,this.timeout=null,this.anchor=new r.Vector(0,this.anchor.y)}update(t){if(this.isEnabled?this.color=r.Color.Red:this.color=r.Color.Transparent,!this.isInterection)return;const e=t.input.pointers.primary.lastWorldPos;if(!e)return;const n=this.parent.pos,i=new r.Vector(e.x-n.x,e.y-n.y),s=Math.min(o,i.distance());this.setWidth(s),this.rotation=i.toAngle()}activate(t){this.setWidth(t.distance()),this.rotation=t.toAngle(),this.isEnabled=!0}deactivate(){this.isEnabled=!1}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(0),o=n(1),i=13;function s(t,e=0){return i*t+e}e.spriteSheet=new r.SpriteSheet(o.Resources.DudeNude,i,21,64,64),e.default={width:64,height:64,columns:i,rows:21,idle:{down:()=>e.spriteSheet.getSprite(s(2)),down_left:()=>e.spriteSheet.getSprite(s(2)),down_right:()=>e.spriteSheet.getSprite(s(2)),up:()=>e.spriteSheet.getSprite(s(0)),up_left:()=>e.spriteSheet.getSprite(s(0)),up_right:()=>e.spriteSheet.getSprite(s(0)),left:()=>e.spriteSheet.getSprite(s(1)),right:()=>e.spriteSheet.getSprite(s(3))},walk:{left:(t,n=75)=>e.spriteSheet.getAnimationBetween(t,s(9),s(9,9),n),right:(t,n=75)=>e.spriteSheet.getAnimationBetween(t,s(11),s(11,9),n),up:(t,n=75)=>e.spriteSheet.getAnimationBetween(t,s(8),s(8,9),n),down:(t,n=75)=>e.spriteSheet.getAnimationBetween(t,s(10),s(10,9),n)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(0),o=n(5),i=n(3),s=n(4);e.default=class extends i.default{constructor(t,e){super(t,e,o.default.width,o.default.height),this.nextPosition=r.Vector.Zero,this.collisionType=r.CollisionType.Passive,this.gunFire=new s.GunFire}onInitialize(t){super.onInitialize(t),this.add(this.gunFire),this.registerDrawing({idle:{up:o.default.idle.up(),down:o.default.idle.down(),right:o.default.idle.right(),left:o.default.idle.left(),up_left:o.default.idle.up_left(),up_right:o.default.idle.up_right(),down_left:o.default.idle.down_left(),down_right:o.default.idle.down_left()},walk:{up:o.default.walk.up(t,75),up_right:o.default.walk.up(t,75),up_left:o.default.walk.up(t,75),down:o.default.walk.down(t,75),down_right:o.default.walk.down(t,75),down_left:o.default.walk.down(t,75),right:o.default.walk.right(t,75),left:o.default.walk.left(t,75)}})}update(t,e){super.update(t,e);const n=this.nextPosition.sub(this.pos);n.equals(r.Vector.Zero)||(this.pos=this.nextPosition),this.direction=n}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(3),o=n(0);e.default=class extends r.default{constructor(t,e){super(t,e,10,10,o.Color.White)}onInitialize(t){}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(0),o=n(6),i=n(7);e.SessionLevel=class extends r.Scene{onInitialize(t){const e=new o.default(0,0),n=new i.default(100,100);this.camera.strategy.elasticToActor(e,.3,.9),this.add(e),this.add(n)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(0),o=n(1),i=7;function s(t,e=0){return i*t+e}e.checkenSpriteSheet=new r.SpriteSheet(o.Resources.Chickens,i,4,12,12),e.default={width:12,height:12,columns:i,rows:4,idle:{down:(t,n=75)=>e.checkenSpriteSheet.getAnimationBetween(t,s(1,0),s(1,6),n),up:(t,n=75)=>e.checkenSpriteSheet.getAnimationBetween(t,s(2,0),s(2,6),n),left:(t,n=75)=>e.checkenSpriteSheet.getAnimationBetween(t,s(0,0),s(0,6),n),right:(t,n=75)=>e.checkenSpriteSheet.getAnimationBetween(t,s(3,0),s(3,6),n)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(0),o=n(9);e.default=class extends r.Actor{constructor(t,e){super(t,e,o.default.width,o.default.height),this.collisionType=r.CollisionType.Passive}onInitialize(t){super.onInitialize(t),this.addDrawing("up",o.default.idle.up(t,150)),this.addDrawing("down",o.default.idle.down(t,150)),this.addDrawing("left",o.default.idle.left(t,150)),this.addDrawing("right",o.default.idle.right(t,150)),this.setDrawing(["up","down","left","right"][(new r.Random).integer(0,3)]),this.scale=new r.Vector(2,2)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(0),o=n(1),i=200;e.Aim=class extends r.Actor{onInitialize(t){this.addDrawing(o.Resources.Aim)}update(t,e){const n=t.input.pointers.primary.lastWorldPos;if(!n)return;const o=this.parent.pos,s=new r.Vector(n.x-o.x,n.y-o.y),a=Math.min(i,s.distance());this.pos=new r.Vector(0,a).rotate(s.toAngle()).rotate(-Math.PI/2)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(0),o=n(5),i=n(3),s=n(4),a=n(2),c=n(11);class u extends i.default{constructor(t,e){super(t,e,o.default.width,o.default.height),this.gunFire=null,this.aim=null,this.sendingDelta=0,this.lastSentPosition=r.Vector.Zero,this.handleKeyPress=(t=>{const e=u.getDirections(t&&t.key||r.Input.Keys.Semicolon);this.direction.addEqual(e)}),this.handleKeyRelease=(t=>{const e=u.getDirections(t&&t.key||r.Input.Keys.Semicolon);this.direction.subEqual(e)}),this.collisionType=r.CollisionType.Passive}onInitialize(t){super.onInitialize(t),this.gunFire=new s.GunFire(!0),this.aim=new c.Aim,this.add(this.gunFire),this.add(this.aim),this.registerDrawing({idle:{up:o.default.idle.up(),down:o.default.idle.down(),right:o.default.idle.right(),left:o.default.idle.left(),up_left:o.default.idle.up_left(),up_right:o.default.idle.up_right(),down_left:o.default.idle.down_left(),down_right:o.default.idle.down_left()},walk:{up:o.default.walk.up(t,150),up_right:o.default.walk.up(t,150),up_left:o.default.walk.up(t,150),down:o.default.walk.down(t,150),down_right:o.default.walk.down(t,150),down_left:o.default.walk.down(t,150),right:o.default.walk.right(t,150),left:o.default.walk.left(t,150)}}),t.input.keyboard.on("press",this.handleKeyPress),t.input.keyboard.on("release",this.handleKeyRelease),t.input.pointers.primary.on("down",()=>{null!=this.gunFire&&(this.gunFire.isEnabled=!0)}),t.input.pointers.primary.on("up",()=>{null!=this.gunFire&&(this.gunFire.isEnabled=!1)})}update(t,e){super.update(t,e),this.sendingDelta+=e,this.pos.addEqual(this.direction.scale(u.speed)),this.sendingDelta>15&&(this.lastSentPosition.sub(this.pos).equals(r.Vector.Zero)||a.GameService.move(0,this.pos),this.gunFire&&this.gunFire.isEnabled&&this.aim&&a.GameService.fire(this.aim.pos),this.sendingDelta=0)}}u.speed=5,u.getDirections=(t=>{switch(t){case r.Input.Keys.A:return r.Vector.Left;case r.Input.Keys.W:return r.Vector.Up;case r.Input.Keys.D:return r.Vector.Right;case r.Input.Keys.S:return r.Vector.Down;default:return r.Vector.Zero}}),e.default=u},function(t,e){var n,r,o=t.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(n===setTimeout)return setTimeout(t,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(t){n=i}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(t){r=s}}();var c,u=[],l=!1,h=-1;function p(){l&&c&&(l=!1,c.length?u=c.concat(u):h=-1,u.length&&f())}function f(){if(!l){var t=a(p);l=!0;for(var e=u.length;e;){for(c=u,u=[];++h<e;)c&&c[h].run();h=-1,e=u.length}c=null,l=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function g(){}o.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];u.push(new d(t,e)),1!==u.length||l||a(f)},d.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=g,o.addListener=g,o.once=g,o.off=g,o.removeListener=g,o.removeAllListeners=g,o.emit=g,o.prependListener=g,o.prependOnceListener=g,o.listeners=function(t){return[]},o.binding=function(t){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(t){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){(function(e,n){
/* @license
 * Copyright (c) .NET Foundation. All rights reserved.
 * Licensed under the Apache License, Version 2.0. See License.txt in the project root for license information.
 */var r;r=function(){"use strict";var t="undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{};function r(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function o(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function i(t,e){return t(e={exports:{}},e.exports),e.exports}i(function(e,o){
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.2+97478eb6
 */
e.exports=function(){function e(t){return"function"==typeof t}var o=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},i=0,s=void 0,a=void 0,c=function(t,e){g[i]=t,g[i+1]=e,2===(i+=2)&&(a?a(v):_())},u="undefined"!=typeof window?window:void 0,l=u||{},h=l.MutationObserver||l.WebKitMutationObserver,p="undefined"==typeof self&&void 0!==n&&"[object process]"==={}.toString.call(n),f="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function d(){var t=setTimeout;return function(){return t(v,1)}}var g=new Array(1e3);function v(){for(var t=0;t<i;t+=2){var e=g[t],n=g[t+1];e(n),g[t]=void 0,g[t+1]=void 0}i=0}var y,w,b,m,_=void 0;function S(t,e){var n=this,r=new this.constructor(k);void 0===r[P]&&W(r);var o=n._state;if(o){var i=arguments[o-1];c(function(){return U(o,r,i,n._result)})}else D(n,r,t,e);return r}function T(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var e=new this(k);return C(e,t),e}p?_=function(){return n.nextTick(v)}:h?(w=0,b=new h(v),m=document.createTextNode(""),b.observe(m,{characterData:!0}),_=function(){m.data=w=++w%2}):f?((y=new MessageChannel).port1.onmessage=v,_=function(){return y.port2.postMessage(0)}):_=void 0===u?function(){try{var t=r,e=t("vertx");return void 0!==(s=e.runOnLoop||e.runOnContext)?function(){s(v)}:d()}catch(t){return d()}}():d();var P=Math.random().toString(36).substring(16);function k(){}var x=void 0,L=1,O=2,A=new G;function M(t){try{return t.then}catch(t){return A.error=t,A}}function E(t,n,r){n.constructor===t.constructor&&r===S&&n.constructor.resolve===T?function(t,e){e._state===L?I(t,e._result):e._state===O?F(t,e._result):D(e,void 0,function(e){return C(t,e)},function(e){return F(t,e)})}(t,n):r===A?(F(t,A.error),A.error=null):void 0===r?I(t,n):e(r)?function(t,e,n){c(function(t){var r=!1,o=function(t,e,n,r){try{t.call(e,n,r)}catch(t){return t}}(n,e,function(n){r||(r=!0,e!==n?C(t,n):I(t,n))},function(e){r||(r=!0,F(t,e))},t._label);!r&&o&&(r=!0,F(t,o))},t)}(t,n,r):I(t,n)}function C(t,e){var n,r;t===e?F(t,new TypeError("You cannot resolve a promise with itself")):(r=typeof(n=e),null===n||"object"!==r&&"function"!==r?I(t,e):E(t,e,M(e)))}function j(t){t._onerror&&t._onerror(t._result),H(t)}function I(t,e){t._state===x&&(t._result=e,t._state=L,0!==t._subscribers.length&&c(H,t))}function F(t,e){t._state===x&&(t._state=O,t._result=e,c(j,t))}function D(t,e,n,r){var o=t._subscribers,i=o.length;t._onerror=null,o[i]=e,o[i+L]=n,o[i+O]=r,0===i&&t._state&&c(H,t)}function H(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var r=void 0,o=void 0,i=t._result,s=0;s<e.length;s+=3)r=e[s],o=e[s+n],r?U(n,r,o,i):o(i);t._subscribers.length=0}}function G(){this.error=null}var R=new G;function U(t,n,r,o){var i=e(r),s=void 0,a=void 0,c=void 0,u=void 0;if(i){if((s=function(t,e){try{return t(e)}catch(t){return R.error=t,R}}(r,o))===R?(u=!0,a=s.error,s.error=null):c=!0,n===s)return void F(n,new TypeError("A promises callback cannot return that same promise."))}else s=o,c=!0;n._state!==x||(i&&c?C(n,s):u?F(n,a):t===L?I(n,s):t===O&&F(n,s))}var N=0;function W(t){t[P]=N++,t._state=void 0,t._result=void 0,t._subscribers=[]}var J=function(){function t(t,e){this._instanceConstructor=t,this.promise=new t(k),this.promise[P]||W(this.promise),o(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?I(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&I(this.promise,this._result))):F(this.promise,new Error("Array Methods must be provided an Array"))}return t.prototype._enumerate=function(t){for(var e=0;this._state===x&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(t,e){var n=this._instanceConstructor,r=n.resolve;if(r===T){var o=M(t);if(o===S&&t._state!==x)this._settledAt(t._state,e,t._result);else if("function"!=typeof o)this._remaining--,this._result[e]=t;else if(n===V){var i=new n(k);E(i,t,o),this._willSettleAt(i,e)}else this._willSettleAt(new n(function(e){return e(t)}),e)}else this._willSettleAt(r(t),e)},t.prototype._settledAt=function(t,e,n){var r=this.promise;r._state===x&&(this._remaining--,t===O?F(r,n):this._result[e]=n),0===this._remaining&&I(r,this._result)},t.prototype._willSettleAt=function(t,e){var n=this;D(t,void 0,function(t){return n._settledAt(L,e,t)},function(t){return n._settledAt(O,e,t)})},t}(),V=function(){function t(e){this[P]=N++,this._result=this._state=void 0,this._subscribers=[],k!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(t,e){try{e(function(e){C(t,e)},function(e){F(t,e)})}catch(e){F(t,e)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(t){return this.then(null,t)},t.prototype.finally=function(t){var e=this.constructor;return this.then(function(n){return e.resolve(t()).then(function(){return n})},function(n){return e.resolve(t()).then(function(){throw n})})},t}();return V.prototype.then=S,V.all=function(t){return new J(this,t).promise},V.race=function(t){var e=this;return o(t)?new e(function(n,r){for(var o=t.length,i=0;i<o;i++)e.resolve(t[i]).then(n,r)}):new e(function(t,e){return e(new TypeError("You must pass an array to race."))})},V.resolve=T,V.reject=function(t){var e=new this(k);return F(e,t),e},V._setScheduler=function(t){a=t},V._setAsap=function(t){c=t},V._asap=c,V.polyfill=function(){var e=void 0;if(void 0!==t)e=t;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var n=e.Promise;if(n){var r=null;try{r=Object.prototype.toString.call(n.resolve())}catch(t){}if("[object Promise]"===r&&!n.cast)return}e.Promise=V},V.Promise=V,V.polyfill(),V}()});var s=i(function(e,n){var r,o=t&&t.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var i=function(t){function e(e,n){var r=t.call(this,e)||this;return r.statusCode=n,r}return o(e,t),e}(Error);n.HttpError=i;var s=function(t){function e(e){return void 0===e&&(e="A timeout occurred."),t.call(this,e)||this}return o(e,t),e}(Error);n.TimeoutError=s});o(s);s.HttpError,s.TimeoutError;var a=i(function(e,n){var r,o=t&&t.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),i=t&&t.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t};Object.defineProperty(n,"__esModule",{value:!0});var a=function(){return function(t,e,n){this.statusCode=t,this.statusText=e,this.content=n}}();n.HttpResponse=a;var c=function(){function t(){}return t.prototype.get=function(t,e){return this.send(i({},e,{method:"GET",url:t}))},t.prototype.post=function(t,e){return this.send(i({},e,{method:"POST",url:t}))},t}();n.HttpClient=c;var u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.send=function(t){return new Promise(function(e,n){var r=new XMLHttpRequest;r.open(t.method,t.url,!0),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.headers&&t.headers.forEach(function(t,e){return r.setRequestHeader(e,t)}),t.responseType&&(r.responseType=t.responseType),t.abortSignal&&(t.abortSignal.onabort=function(){r.abort()}),t.timeout&&(r.timeout=t.timeout),r.onload=function(){t.abortSignal&&(t.abortSignal.onabort=null),r.status>=200&&r.status<300?e(new a(r.status,r.statusText,r.response||r.responseText)):n(new s.HttpError(r.statusText,r.status))},r.onerror=function(){n(new s.HttpError(r.statusText,r.status))},r.ontimeout=function(){n(new s.TimeoutError)},r.send(t.content||"")})},e}(c);n.DefaultHttpClient=u});o(a);a.HttpResponse,a.HttpClient,a.DefaultHttpClient;var c=i(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.Trace=0]="Trace",t[t.Information=1]="Information",t[t.Warning=2]="Warning",t[t.Error=3]="Error",t[t.None=4]="None"}(e.LogLevel||(e.LogLevel={}))});o(c);c.LogLevel;var u=i(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){this.isAborted=!1}return t.prototype.abort=function(){this.isAborted||(this.isAborted=!0,this.onabort&&this.onabort())},Object.defineProperty(t.prototype,"signal",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"aborted",{get:function(){return this.isAborted},enumerable:!0,configurable:!0}),t}();e.AbortController=n});o(u);u.AbortController;var l=i(function(e,n){var r=t&&t.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(o,i){function s(t){try{c(r.next(t))}catch(t){i(t)}}function a(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(s,a)}c((r=r.apply(t,e||[])).next())})},o=t&&t.__generator||function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(n,"__esModule",{value:!0}),function(t){t[t.WebSockets=0]="WebSockets",t[t.ServerSentEvents=1]="ServerSentEvents",t[t.LongPolling=2]="LongPolling"}(n.TransportType||(n.TransportType={}));var i=function(){function t(t,e){this.logger=e,this.accessTokenFactory=t||function(){return null}}return t.prototype.connect=function(t,e,n){var r=this;return new Promise(function(n,o){t=t.replace(/^http/,"ws");var i=r.accessTokenFactory();i&&(t+=(t.indexOf("?")<0?"?":"&")+"access_token="+encodeURIComponent(i));var s=new WebSocket(t);2==e&&(s.binaryType="arraybuffer"),s.onopen=function(o){r.logger.log(c.LogLevel.Information,"WebSocket connected to "+t),r.webSocket=s,n(e)},s.onerror=function(t){o()},s.onmessage=function(t){r.logger.log(c.LogLevel.Trace,"(WebSockets transport) data received: "+t.data),r.onreceive&&r.onreceive(t.data)},s.onclose=function(t){r.onclose&&r.webSocket&&(!1===t.wasClean||1e3!==t.code?r.onclose(new Error("Websocket closed with status code: "+t.code+" ("+t.reason+")")):r.onclose())}})},t.prototype.send=function(t){return this.webSocket&&this.webSocket.readyState===WebSocket.OPEN?(this.webSocket.send(t),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")},t.prototype.stop=function(){return this.webSocket&&(this.webSocket.close(),this.webSocket=null),Promise.resolve()},t}();n.WebSocketTransport=i;var a=function(){function t(t,e,n){this.httpClient=t,this.accessTokenFactory=e||function(){return null},this.logger=n}return t.prototype.connect=function(t,e,n){var r=this;return"undefined"==typeof EventSource&&Promise.reject("EventSource not supported by the browser."),this.url=t,new Promise(function(e,n){var o=r.accessTokenFactory();o&&(t+=(t.indexOf("?")<0?"?":"&")+"access_token="+encodeURIComponent(o));var i=new EventSource(t);try{i.onmessage=function(t){if(r.onreceive)try{r.logger.log(c.LogLevel.Trace,"(SSE transport) data received: "+t.data),r.onreceive(t.data)}catch(t){return void(r.onclose&&r.onclose(t))}},i.onerror=function(t){n(),r.eventSource&&r.onclose&&r.onclose(new Error(t.message||"Error occurred"))},i.onopen=function(){r.logger.log(c.LogLevel.Information,"SSE connected to "+r.url),r.eventSource=i,e(1)}}catch(t){return Promise.reject(t)}})},t.prototype.send=function(t){return r(this,void 0,void 0,function(){return o(this,function(e){return[2,h(this.httpClient,this.url,this.accessTokenFactory,t)]})})},t.prototype.stop=function(){return this.eventSource&&(this.eventSource.close(),this.eventSource=null),Promise.resolve()},t}();n.ServerSentEventsTransport=a;var l=function(){function t(t,e,n){this.httpClient=t,this.accessTokenFactory=e||function(){return null},this.logger=n,this.pollAbort=new u.AbortController}return t.prototype.connect=function(t,e,n){if(this.url=t,n.features.inherentKeepAlive=!0,2===e&&"string"!=typeof(new XMLHttpRequest).responseType)throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");return this.poll(this.url,e),Promise.resolve(e)},t.prototype.poll=function(t,e){return r(this,void 0,void 0,function(){var n,r,i,a,u;return o(this,function(o){switch(o.label){case 0:n={timeout:12e4,abortSignal:this.pollAbort.signal,headers:new Map},2===e&&(n.responseType="arraybuffer"),(r=this.accessTokenFactory())&&n.headers.set("Authorization","Bearer "+r),o.label=1;case 1:if(this.pollAbort.signal.aborted)return[3,6];o.label=2;case 2:return o.trys.push([2,4,,5]),i=t+"&_="+Date.now(),this.logger.log(c.LogLevel.Trace,"(LongPolling transport) polling: "+i),[4,this.httpClient.get(i,n)];case 3:return 204===(a=o.sent()).statusCode?(this.logger.log(c.LogLevel.Information,"(LongPolling transport) Poll terminated by server"),this.onclose&&this.onclose(),this.pollAbort.abort()):200!==a.statusCode?(this.logger.log(c.LogLevel.Error,"(LongPolling transport) Unexpected response code: "+a.statusCode),this.onclose&&this.onclose(new s.HttpError(a.statusText,a.statusCode)),this.pollAbort.abort()):a.content?(this.logger.log(c.LogLevel.Trace,"(LongPolling transport) data received: "+a.content),this.onreceive&&this.onreceive(a.content)):this.logger.log(c.LogLevel.Trace,"(LongPolling transport) Poll timed out, reissuing."),[3,5];case 4:return(u=o.sent())instanceof s.TimeoutError?this.logger.log(c.LogLevel.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this.onclose&&this.onclose(u),this.pollAbort.abort()),[3,5];case 5:return[3,1];case 6:return[2]}})})},t.prototype.send=function(t){return r(this,void 0,void 0,function(){return o(this,function(e){return[2,h(this.httpClient,this.url,this.accessTokenFactory,t)]})})},t.prototype.stop=function(){return this.pollAbort.abort(),Promise.resolve()},t}();function h(t,e,n,i){return r(this,void 0,void 0,function(){var r;return o(this,function(o){switch(o.label){case 0:return n()&&(r=new Map).set("Authorization","Bearer "+n()),[4,t.post(e,{content:i,headers:r})];case 1:return o.sent(),[2]}})})}n.LongPollingTransport=l});o(l);l.TransportType,l.WebSocketTransport,l.ServerSentEventsTransport,l.LongPollingTransport;var h=i(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return t.prototype.log=function(t,e){},t}();e.NullLogger=n;var r=function(){function t(t){this.minimumLogLevel=t}return t.prototype.log=function(t,e){if(t>=this.minimumLogLevel)switch(t){case c.LogLevel.Error:console.error(c.LogLevel[t]+": "+e);break;case c.LogLevel.Warning:console.warn(c.LogLevel[t]+": "+e);break;case c.LogLevel.Information:console.info(c.LogLevel[t]+": "+e);break;default:console.log(c.LogLevel[t]+": "+e)}},t}();e.ConsoleLogger=r,function(t){t.createLogger=function(t){return void 0===t?new r(c.LogLevel.Information):null===t?new n:t.log?t:new r(t)}}(e.LoggerFactory||(e.LoggerFactory={}))});o(h);h.NullLogger,h.ConsoleLogger,h.LoggerFactory;var p=i(function(e,n){var r=t&&t.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(o,i){function s(t){try{c(r.next(t))}catch(t){i(t)}}function a(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(s,a)}c((r=r.apply(t,e||[])).next())})},o=t&&t.__generator||function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e){void 0===e&&(e={}),this.features={},this.logger=h.LoggerFactory.createLogger(e.logger),this.baseUrl=this.resolveUrl(t),(e=e||{}).accessTokenFactory=e.accessTokenFactory||function(){return null},this.httpClient=e.httpClient||new a.DefaultHttpClient,this.connectionState=2,this.options=e}return t.prototype.start=function(){return r(this,void 0,void 0,function(){return o(this,function(t){return 2!==this.connectionState?[2,Promise.reject(new Error("Cannot start a connection that is not in the 'Disconnected' state."))]:(this.connectionState=0,this.startPromise=this.startInternal(),[2,this.startPromise])})})},t.prototype.startInternal=function(){return r(this,void 0,void 0,function(){var t,e,n,r,i,s,a,u=this;return o(this,function(o){switch(o.label){case 0:return o.trys.push([0,5,,6]),this.options.transport!==l.TransportType.WebSockets?[3,1]:(this.url=this.baseUrl,this.transport=this.createTransport(this.options.transport,[l.TransportType[l.TransportType.WebSockets]]),[3,3]);case 1:return t=void 0,(e=this.options.accessTokenFactory())&&(t=new Map).set("Authorization","Bearer "+e),[4,this.httpClient.post(this.resolveNegotiateUrl(this.baseUrl),{content:"",headers:t})];case 2:if(n=o.sent(),r=JSON.parse(n.content),this.connectionId=r.connectionId,2==this.connectionState)return[2];this.connectionId&&(this.url=this.baseUrl+(-1===this.baseUrl.indexOf("?")?"?":"&")+"id="+this.connectionId,this.transport=this.createTransport(this.options.transport,r.availableTransports)),o.label=3;case 3:return this.transport.onreceive=this.onreceive,this.transport.onclose=function(t){return u.stopConnection(!0,t)},i=2===this.features.transferMode?2:1,s=this.features,[4,this.transport.connect(this.url,i,this)];case 4:return s.transferMode=o.sent(),this.changeState(0,1),[3,6];case 5:throw a=o.sent(),this.logger.log(c.LogLevel.Error,"Failed to start the connection. "+a),this.connectionState=2,this.transport=null,a;case 6:return[2]}})})},t.prototype.createTransport=function(t,e){if((null===t||void 0===t)&&e.length>0&&(t=l.TransportType[e[0]]),t===l.TransportType.WebSockets&&e.indexOf(l.TransportType[t])>=0)return new l.WebSocketTransport(this.options.accessTokenFactory,this.logger);if(t===l.TransportType.ServerSentEvents&&e.indexOf(l.TransportType[t])>=0)return new l.ServerSentEventsTransport(this.httpClient,this.options.accessTokenFactory,this.logger);if(t===l.TransportType.LongPolling&&e.indexOf(l.TransportType[t])>=0)return new l.LongPollingTransport(this.httpClient,this.options.accessTokenFactory,this.logger);if(this.isITransport(t))return t;throw new Error("No available transports found.")},t.prototype.isITransport=function(t){return"object"==typeof t&&"connect"in t},t.prototype.changeState=function(t,e){return this.connectionState==t&&(this.connectionState=e,!0)},t.prototype.send=function(t){if(1!=this.connectionState)throw new Error("Cannot send data if the connection is not in the 'Connected' State");return this.transport.send(t)},t.prototype.stop=function(t){return r(this,void 0,void 0,function(){var e;return o(this,function(n){switch(n.label){case 0:e=this.connectionState,this.connectionState=2,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.startPromise];case 2:return n.sent(),[3,4];case 3:return n.sent(),[3,4];case 4:return this.stopConnection(1==e,t),[2]}})})},t.prototype.stopConnection=function(t,e){this.transport&&(this.transport.stop(),this.transport=null),e?this.logger.log(c.LogLevel.Error,"Connection disconnected with error '"+e+"'."):this.logger.log(c.LogLevel.Information,"Connection disconnected."),this.connectionState=2,t&&this.onclose&&this.onclose(e)},t.prototype.resolveUrl=function(t){if(0===t.lastIndexOf("https://",0)||0===t.lastIndexOf("http://",0))return t;if("undefined"==typeof window||!window||!window.document)throw new Error("Cannot resolve '"+t+"'.");var e=window.document.createElement("a");e.href=t;var n=e.protocol&&":"!==e.protocol?e.protocol+"//"+e.host:window.document.location.protocol+"//"+(e.host||window.document.location.host);t&&"/"==t[0]||(t="/"+t);var r=n+t;return this.logger.log(c.LogLevel.Information,"Normalizing '"+t+"' to '"+r+"'"),r},t.prototype.resolveNegotiateUrl=function(t){var e=t.indexOf("?"),n=t.substring(0,-1===e?t.length:e);return"/"!==n[n.length-1]&&(n+="/"),n+="negotiate",n+=-1===e?"":t.substring(e)},t}();n.HttpConnection=i});o(p);p.HttpConnection;var f=i(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){this.subject=t,this.observer=e}return t.prototype.dispose=function(){var t=this.subject.observers.indexOf(this.observer);t>-1&&this.subject.observers.splice(t,1),0===this.subject.observers.length&&this.subject.cancelCallback().catch(function(t){})},t}();e.Subscription=n;var r=function(){function t(t){this.observers=[],this.cancelCallback=t}return t.prototype.next=function(t){for(var e=0,n=this.observers;e<n.length;e++){n[e].next(t)}},t.prototype.error=function(t){for(var e=0,n=this.observers;e<n.length;e++){var r=n[e];r.error&&r.error(t)}},t.prototype.complete=function(){for(var t=0,e=this.observers;t<e.length;t++){var n=e[t];n.complete&&n.complete()}},t.prototype.subscribe=function(t){return this.observers.push(t),new n(this,t)},t}();e.Subject=r});o(f);f.Subscription,f.Subject;var d=i(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return t.write=function(e){return""+e+t.RecordSeparator},t.parse=function(e){if(e[e.length-1]!=t.RecordSeparator)throw new Error("Message is incomplete.");var n=e.split(t.RecordSeparator);return n.pop(),n},t.RecordSeparator=String.fromCharCode(30),t}();e.TextMessageFormat=n});o(d);d.TextMessageFormat;var g=i(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.JSON_HUB_PROTOCOL_NAME="json";var n=function(){function t(){this.name=e.JSON_HUB_PROTOCOL_NAME,this.type=1}return t.prototype.parseMessages=function(t){if(!t)return[];for(var e=d.TextMessageFormat.parse(t),n=[],r=0;r<e.length;++r)n.push(JSON.parse(e[r]));return n},t.prototype.writeMessage=function(t){return d.TextMessageFormat.write(JSON.stringify(t))},t}();e.JsonHubProtocol=n});o(g);g.JSON_HUB_PROTOCOL_NAME,g.JsonHubProtocol;var v=i(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.wrappedProtocol=t,this.name=this.wrappedProtocol.name,this.type=1}return t.prototype.parseMessages=function(t){var e=t.indexOf(":");if(-1==e||";"!=t[t.length-1])throw new Error("Invalid payload.");var n=t.substring(0,e);if(!/^[0-9]+$/.test(n))throw new Error("Invalid length: '"+n+"'");if(parseInt(n,10)!=t.length-e-2)throw new Error("Invalid message size.");for(var r=t.substring(e+1,t.length-1),o=atob(r),i=new Uint8Array(o.length),s=0;s<i.length;s++)i[s]=o.charCodeAt(s);return this.wrappedProtocol.parseMessages(i.buffer)},t.prototype.writeMessage=function(t){for(var e=new Uint8Array(this.wrappedProtocol.writeMessage(t)),n="",r=0;r<e.byteLength;r++)n+=String.fromCharCode(e[r]);var o=btoa(n);return o.length.toString()+":"+o+";"},t}();e.Base64EncodedHubProtocol=n});o(v);v.Base64EncodedHubProtocol;var y=i(function(e,n){var r=t&&t.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(o,i){function s(t){try{c(r.next(t))}catch(t){i(t)}}function a(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(s,a)}c((r=r.apply(t,e||[])).next())})},o=t&&t.__generator||function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.JsonHubProtocol=g.JsonHubProtocol;var i=3e4,s=function(){function t(t,e){void 0===e&&(e={});var n=this;e=e||{},this.timeoutInMilliseconds=e.timeoutInMilliseconds||i,this.connection="string"==typeof t?new p.HttpConnection(t,e):t,this.logger=h.LoggerFactory.createLogger(e.logger),this.protocol=e.protocol||new g.JsonHubProtocol,this.connection.onreceive=function(t){return n.processIncomingData(t)},this.connection.onclose=function(t){return n.connectionClosed(t)},this.callbacks=new Map,this.methods=new Map,this.closedCallbacks=[],this.id=0}return t.prototype.processIncomingData=function(t){void 0!==this.timeoutHandle&&clearTimeout(this.timeoutHandle);for(var e=this.protocol.parseMessages(t),n=0;n<e.length;++n){var r=e[n];switch(r.type){case 1:this.invokeClientMethod(r);break;case 2:case 3:var o=this.callbacks.get(r.invocationId);null!=o&&(3===r.type&&this.callbacks.delete(r.invocationId),o(r));break;case 6:break;default:this.logger.log(c.LogLevel.Warning,"Invalid message type: "+t)}}this.configureTimeout()},t.prototype.configureTimeout=function(){var t=this;this.connection.features&&this.connection.features.inherentKeepAlive||(this.timeoutHandle=setTimeout(function(){return t.serverTimeout()},this.timeoutInMilliseconds))},t.prototype.serverTimeout=function(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))},t.prototype.invokeClientMethod=function(t){var e=this,n=this.methods.get(t.target.toLowerCase());if(n){if(n.forEach(function(n){return n.apply(e,t.arguments)}),t.invocationId){var r="Server requested a response, which is not supported in this version of the client.";this.logger.log(c.LogLevel.Error,r),this.connection.stop(new Error(r))}}else this.logger.log(c.LogLevel.Warning,"No client method with the name '"+t.target+"' found.")},t.prototype.connectionClosed=function(t){var e=this;this.callbacks.forEach(function(e){e(void 0,t||new Error("Invocation canceled due to connection being closed."))}),this.callbacks.clear(),this.closedCallbacks.forEach(function(n){return n.apply(e,[t])}),this.cleanupTimeout()},t.prototype.start=function(){return r(this,void 0,void 0,function(){var t,e;return o(this,function(n){switch(n.label){case 0:return t=2===this.protocol.type?2:1,this.connection.features.transferMode=t,[4,this.connection.start()];case 1:return n.sent(),e=this.connection.features.transferMode,[4,this.connection.send(d.TextMessageFormat.write(JSON.stringify({protocol:this.protocol.name})))];case 2:return n.sent(),this.logger.log(c.LogLevel.Information,"Using HubProtocol '"+this.protocol.name+"'."),2===t&&1===e&&(this.protocol=new v.Base64EncodedHubProtocol(this.protocol)),this.configureTimeout(),[2]}})})},t.prototype.stop=function(){return this.cleanupTimeout(),this.connection.stop()},t.prototype.stream=function(t){for(var e=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var o=this.createStreamInvocation(t,n),i=new f.Subject(function(){var t=e.createCancelInvocation(o.invocationId),n=e.protocol.writeMessage(t);return e.callbacks.delete(o.invocationId),e.connection.send(n)});this.callbacks.set(o.invocationId,function(t,e){if(e)i.error(e);else if(3===t.type){var n=t;n.error?i.error(new Error(n.error)):i.complete()}else i.next(t.item)});var s=this.protocol.writeMessage(o);return this.connection.send(s).catch(function(t){i.error(t),e.callbacks.delete(o.invocationId)}),i},t.prototype.send=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=this.createInvocation(t,e,!0),o=this.protocol.writeMessage(r);return this.connection.send(o)},t.prototype.invoke=function(t){for(var e=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var o=this.createInvocation(t,n,!1);return new Promise(function(t,n){e.callbacks.set(o.invocationId,function(e,r){if(r)n(r);else if(3===e.type){var o=e;o.error?n(new Error(o.error)):t(o.result)}else n(new Error("Unexpected message type: "+e.type))});var r=e.protocol.writeMessage(o);e.connection.send(r).catch(function(t){n(t),e.callbacks.delete(o.invocationId)})})},t.prototype.on=function(t,e){t&&e&&(t=t.toLowerCase(),this.methods.has(t)||this.methods.set(t,[]),this.methods.get(t).push(e))},t.prototype.off=function(t,e){if(t&&e){t=t.toLowerCase();var n=this.methods.get(t);if(n){var r=n.indexOf(e);-1!=r&&n.splice(r,1)}}},t.prototype.onclose=function(t){t&&this.closedCallbacks.push(t)},t.prototype.cleanupTimeout=function(){this.timeoutHandle&&clearTimeout(this.timeoutHandle)},t.prototype.createInvocation=function(t,e,n){if(n)return{type:1,target:t,arguments:e};var r=this.id;return this.id++,{type:1,invocationId:r.toString(),target:t,arguments:e}},t.prototype.createStreamInvocation=function(t,e){var n=this.id;return this.id++,{type:4,invocationId:n.toString(),target:t,arguments:e}},t.prototype.createCancelInvocation=function(t){return{type:5,invocationId:t}},t}();n.HubConnection=s});o(y);y.JsonHubProtocol,y.HubConnection;var w=i(function(t,e){Object.defineProperty(e,"__esModule",{value:!0})});o(w);var b=i(function(t,e){function n(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),n(s),n(a),n(p),n(y),n(w),n(c),n(h),n(l),n(f)});return o(b),o(i(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(b)}))},t.exports=r()}).call(this,n(14),n(13))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(0);e.default=class{constructor(t,e,n,o){this.target=t,this.border=e,this.cameraElasticity=n,this.cameraFriction=o,this.action=((t,e,n,o)=>{let i=t.getCenter(),s=e.getFocus(),a=new r.Vector(e.dx,e.dy);const c=i.sub(s).scale(this.cameraElasticity),u=(a=a.add(c)).scale(-1).scale(this.cameraFriction);a=a.add(u),s=s.add(a);const l=Math.min(Math.max(n.halfDrawWidth,s.x),this.border.x-n.halfDrawWidth),h=Math.min(Math.max(n.halfDrawHeight,s.y),this.border.y-n.halfDrawHeight);return new r.Vector(l,h)})}}},function(t,e,n){var r;r=function(t){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";var r,o=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var i,s=n(1);!function(t){t[t.TMX=0]="TMX",t[t.JSON=1]="JSON"}(i=e.TiledMapFormat||(e.TiledMapFormat={}));var a=function(t){function e(e,n){void 0===n&&(n=i.JSON);var r=this;switch(n){case i.JSON:r=t.call(this,e,"json")||this;break;default:throw"The format "+n+" is not currently supported. Please export Tiled map as JSON."}return r.mapFormat=n,r.imagePathAccessor=r.externalTilesetPathAccessor=function(t,n){if(0===t.indexOf("/"))return t;var r=e.split("/"),o=r.concat([]);return r.length>0&&o.splice(-1),o.push(t),o.join("/")},r}return o(e,t),e.prototype.load=function(){var e=this,n=new s.Promise;return t.prototype.load.call(this).then(function(t){var r=[];e.data.tilesets.forEach(function(t){if(t.source){var n=new s.Resource(e.externalTilesetPathAccessor(t.source,t),"json");r.push(n.load().then(function(e){Object.assign(t,e)}))}}),s.Promise.join.apply(e,r).then(function(){r=[],e.data.tilesets.forEach(function(t){var n=new s.Texture(e.imagePathAccessor(t.image,t));t.imageTexture=n,r.push(n.load()),s.Logger.getInstance().debug("[Tiled] Loading associated tileset: "+t.image)}),s.Promise.join.apply(e,r).then(function(){n.resolve(t)},function(t){n.reject(t)})},function(t){n.reject(t)})}),n},e.prototype.processData=function(t){if("object"!=typeof t)throw"Tiled map resource "+this.path+" is not the correct content type";if(void 0===t)throw"Tiled map resource "+this.path+" is empty";switch(this.mapFormat){case i.JSON:return c(t)}},e.prototype.getTilesetForTile=function(t){for(var e=this.data.tilesets.length-1;e>=0;e--){var n=this.data.tilesets[e];if(n.firstgid<=t)return n}return null},e.prototype.getTileMap=function(){for(var t=new s.TileMap(0,0,this.data.tilewidth,this.data.tileheight,this.data.height,this.data.width),e=0,n=this.data.tilesets;e<n.length;e++){var r=n[e],o=Math.floor(r.imagewidth/r.tilewidth),i=Math.floor(r.imageheight/r.tileheight),a=new s.SpriteSheet(r.imageTexture,o,i,r.tilewidth,r.tileheight);t.registerSpriteSheet(r.firstgid.toString(),a)}for(var c=0,u=this.data.layers;c<u.length;c++){var l=u[c];if("tilelayer"===l.type)for(var h=0;h<l.data.length;h++){var p=l.data[h];if(0!==p){r=this.getTilesetForTile(p);t.data[h].sprites.push(new s.TileSprite(r.firstgid.toString(),p-r.firstgid))}}}return t},e}(s.Resource);e.default=a;var c=function(t){if(t.layers)for(var e=0,n=t.layers;e<n.length;e++){var r=n[e];"string"==typeof r.data?"base64"===r.encoding&&(r.data=u.decompressBase64(r.data,r.encoding)):r.data=u.decompressCsv(r.data)}return t},u={decompressCsv:function(t){return t},decompressBase64:function(t,e){var n,r,o,i,s,a;if(t.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var c="undefined"!=typeof Uint8Array?Uint8Array:Array,u="+".charCodeAt(0),l="/".charCodeAt(0),h="0".charCodeAt(0),p="a".charCodeAt(0),f="A".charCodeAt(0),d="-".charCodeAt(0),g="_".charCodeAt(0);function v(t){var e=t.charCodeAt(0);return e===u||e===d?62:e===l||e===g?63:e<h?-1:e<h+10?e-h+26+26:e<f+26?e-f:e<p+26?e-p+26:void 0}var y=t.length;s="="===t.charAt(y-2)?2:"="===t.charAt(y-1)?1:0,a=new c(3*t.length/4-s),o=s>0?t.length-4:t.length;var w=0;function b(t){a[w++]=t}for(n=0,r=0;n<o;n+=4,r+=3)b((16711680&(i=v(t.charAt(n))<<18|v(t.charAt(n+1))<<12|v(t.charAt(n+2))<<6|v(t.charAt(n+3))))>>16),b((65280&i)>>8),b(255&i);2===s?b(255&(i=v(t.charAt(n))<<2|v(t.charAt(n+1))>>4)):1===s&&(b((i=v(t.charAt(n))<<10|v(t.charAt(n+1))<<4|v(t.charAt(n+2))>>2)>>8&255),b(255&i));var m=function(t){for(var e=0,n=t.length-1;n>=0;n--)e=256*e+1*t[n];return e},_=a.length/4,S=new Array(_);for(n=0;n<_;n++)S[n]=m(a.slice(4*n,4*n+3));return S}}},function(e,n){e.exports=t}])},t.exports=r(n(0))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(0),o=n(6),i=n(1),s=n(16),a=n(2),c=n(12),u=n(10);e.Level1=class extends r.Scene{onInitialize(t){const e=i.Resources.Level1.getTileMap(),n=new r.Vector(e.cellWidth*e.cols,e.cellHeight*e.rows);this.add(e),a.GameService.connection.on("me",t=>{const e=new c.default(t.position.x,t.position.y);a.GameService.saveUser({user:t,actor:e}),this.add(e),this.camera.addStrategy(new s.default(e,n,.3,.9))}),a.GameService.connection.on("playerJoin",t=>this.joinPlayer(t)),a.GameService.connection.on("players",t=>t.forEach(this.joinPlayer)),a.GameService.connection.on("playerState",t=>{const e=a.GameService.getActor(t.id);e&&(e.nextPosition=new r.Vector(t.position.x,t.position.y))}),a.GameService.connection.on("playerStateNumber",t=>{}),a.GameService.connection.on("playerAttack",(t,e)=>{const n=a.GameService.getActor(t.id);n&&(n.gunFire.timeout&&(clearTimeout(n.gunFire.timeout),n.gunFire.timeout=null),n.gunFire.activate(new r.Vector(e.x,e.y)),n.gunFire.timeout=setTimeout(()=>{n.gunFire.deactivate()},100))}),a.GameService.connection.on("playerLeave",t=>{const e=a.GameService.getActor(t.id);e&&e.kill(),a.GameService.kickUser(t)}),a.GameService.connection.on("fowlJoin",t=>{const e=new u.default(t.position.x,t.position.y);this.add(e),a.GameService.addFowl({user:t,actor:e})}),a.GameService.connection.on("killFowl",t=>{const e=a.GameService.getActor(t.id);e&&e.kill(),a.GameService.killFowl(t)})}joinPlayer(t){if(!a.GameService.userInGame(t.id)){const e=new o.default(t.position.x,t.position.y);this.add(e),a.GameService.saveOtherPlayer({user:t,actor:e})}}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(0),o=n(18),i=n(8);e.Game=class extends r.Engine{constructor(){super({displayMode:r.DisplayMode.FullScreen})}start(t){return this.input.keyboard.on("press",t=>null!=t&&t.key===r.Input.Keys.Space&&this.goToScene("session")),this.add("level1",new o.Level1),this.add("session",new i.SessionLevel),super.start(t).then(()=>{this.goToScene("level1")})}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(0),o=n(19),i=n(1),s=n(2),a=new o.Game,c=new r.Loader;c.addResources(i.Resources.values()),a.start(c).then(()=>{console.log("Started"),s.GameService.start()})}]);
//# sourceMappingURL=game.js.map